<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/httpParser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/httpParser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { HTTPbody, JSONbodyParser, queryParser } = require("./utils.js");

/**
 * Parses an HTTP request into a structured object containing method, path, query, and body.
 * @async
 * @function httpParser
 * @param {Buffer|string} request - The raw HTTP request data, typically a Buffer or string.
 * @returns {Promise&lt;Object>} Parsed HTTP request object containing:
 * - `method` {string}: HTTP method (e.g., "GET", "POST").
 * - `path` {string}: Path from the request line, without the query string.
 * - `version` {string}: HTTP version (e.g., "HTTP/1.1").
 * - `query` {Object}: Parsed query parameters (for GET requests).
 * - `body` {Object|undefined}: Parsed JSON body (for POST requests).
 * @throws Will throw an error if the body cannot be parsed as JSON for POST requests.
 */
async function httpParser(request) {
  const req = {}; // Create a new object to store the parsed request
  const requestString = request.toString(); // Convert buffer to string, if necessary

  // Step 1: Split the request into headers and body by finding "\r\n\r\n"
  const headerBodySplit = requestString.split("\r\n\r\n"); // Headers and body are separated by double newline
  const headersPart = headerBodySplit[0]; // First part is the headers
  const bodyPart = headerBodySplit[1]; // Second part is the body

  // Step 2: Extract the headers (the first line is the request line, e.g., "POST /path HTTP/1.1")
  const headers = headersPart.split("\n");

  // Parse the request line (first line of the headers)
  const requestLine = headers[0].split(" "); // ["POST", "/path", "HTTP/1.1"]
  req.method = requestLine[0]; // e.g., "POST"
  req.path = requestLine[1]; // e.g., "/path"
  req.version = requestLine[2]; // e.g., "HTTP/1.1"

  // Step 3: Handle GET requests (expect a query string)
  req.query = queryParser(req.path); // Parse query string for GET requests
  req.path = req.path.split("?")[0]; // Remove query string from path

  // Step 4: Handle POST requests (expect a body)
  if (req.method === "POST") {
    // Now we need to parse the body, which is in `bodyPart`
    const position = 0; // Start at position 0 of the bodyPart

    // Await the body parsing (this is an async operation)
    const bodyData = await HTTPbody(bodyPart, position);

    // Step 5: Parse the body into JSON format
    try {
      req.body = JSONbodyParser(bodyData); // Convert the parsed body into JSON
    } catch (error) {
      console.error("Error parsing JSON body:", error);
    }

    return req; // Return the fully parsed request object
  }

  // Step 6: If it's another HTTP method, just return the parsed headers
  return req;
}

module.exports = { httpParser };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Hasty.html">Hasty</a></li><li><a href="RadixTree.html">RadixTree</a></li><li><a href="RadixTreeNode.html">RadixTreeNode</a></li><li><a href="Response.html">Response</a></li><li><a href="Server.html">Server</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-tutorial.html">tutorial</a></li></ul><h3>Global</h3><ul><li><a href="global.html#HTTPbody">HTTPbody</a></li><li><a href="global.html#JSONbodyParser">JSONbodyParser</a></li><li><a href="global.html#cleanUpBody">cleanUpBody</a></li><li><a href="global.html#extractParams">extractParams</a></li><li><a href="global.html#findFirstBrac">findFirstBrac</a></li><li><a href="global.html#getSocket">getSocket</a></li><li><a href="global.html#handler">handler</a></li><li><a href="global.html#httpParser">httpParser</a></li><li><a href="global.html#lookupMimeType">lookupMimeType</a></li><li><a href="global.html#matchRouteWithParams">matchRouteWithParams</a></li><li><a href="global.html#mimeDb">mimeDb</a></li><li><a href="global.html#parseValue">parseValue</a></li><li><a href="global.html#pathController">pathController</a></li><li><a href="global.html#queryParser">queryParser</a></li><li><a href="global.html#storePair">storePair</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
